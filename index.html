<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NJ936 è°ƒåº¦æ—¥æŠ¥ç”Ÿæˆå™¨ V2.9 (éšè—å«æ˜Ÿä»“ç‰ˆ)</title>
    <style>
        :root { --primary: #2563eb; --bg: #f3f4f6; --card: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); padding: 20px; max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; color: #1e293b; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 20px; }
        .inherit-box { background: #fffbeb; border: 2px dashed #fcd34d; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .inherit-box textarea { width: 100%; height: 80px; margin-top: 5px; border: 1px solid #d1d5db; border-radius: 4px; box-sizing: border-box; }
        .card { background: var(--card); padding: 18px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 5px solid var(--primary); margin-bottom: 15px; }
        .card h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 8px; font-size: 1.1em; }
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 12px; }
        input { padding: 6px; border: 1px solid #d1d5db; border-radius: 4px; }
        .btn-dest { background: #f0f9ff; border: 1px solid #7dd3fc; color: #0369a1; cursor: pointer; padding: 4px 10px; border-radius: 4px; }
        .btn-dest.active { background: #0284c7; color: white; }
        .btn-add { background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .queue-list { background: #f9fafb; padding: 8px; border-radius: 4px; font-size: 0.85em; margin-top: 10px; color: #666; }
        .queue-item { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px dashed #eee; }
        .del-btn { color: #ef4444; cursor: pointer; font-weight: bold; }
        .btn-gen { background: #4f46e5; color: white; border: none; padding: 15px; width: 100%; font-size: 1.1em; border-radius: 8px; cursor: pointer; margin-top: 20px; }
        textarea#resultArea { width: 100%; height: 350px; margin-top: 15px; border-radius: 8px; padding: 10px; box-sizing: border-box; font-family: monospace; white-space: pre; }
        .btn-copy { background: #374151; color: white; margin-top: 10px; width: 100%; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
        
        /* å¤šç«™ç‚¹è¾“å…¥æ¡†æ ·å¼ */
        .multi-stop-box { background: #f1f5f9; padding: 8px; border-radius: 4px; display: none; gap: 8px; align-items: center; flex-wrap: wrap; }
        .multi-stop-box label { font-size: 0.9em; color: #444; }
        .multi-stop-box input { width: 50px; text-align: center; }

        .s1 { border-left-color: #ef4444; } 
        /* s2 éšè—é€»è¾‘ */
        .s2 { border-left-color: #f59e0b; display: none; } 
        .s3 { border-left-color: #10b981; } 
        .s4 { border-left-color: #8b5cf6; } 
        .s5 { border-left-color: #ec4899; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <h1>ğŸšš NJ936 è°ƒåº¦å·¥å…· V2.9</h1>
    <div class="subtitle" id="displayDate"></div>

    <div class="inherit-box">
        <h4>ğŸ”— ç»§æ‰¿æ¥é¾™æ¨¡å¼</h4>
        <textarea id="baseReport" placeholder="åœ¨æ­¤ç²˜è´´ã€ä¸Šç­ã€‘æ—¥æŠ¥å†…å®¹..."></textarea>
    </div>

    <div class="container">
        <div class="card s1">
            <h3>ğŸŒŸã€NJ936-80så¤§åŒºè½¬è¿ã€‘</h3>
            <div class="input-group">
                <div id="s1-dests">
                    <button class="btn-dest" onclick="setS1Dest('ORD')">ORD</button>
                    <button class="btn-dest" onclick="setS1Dest('DFW')">DFW</button>
                    <button class="btn-dest" onclick="setS1Dest('IAH')">IAH</button>
                    <button class="btn-dest" onclick="setS1Dest('CMH-CVG-SDF')">CMH-CVG-SDF</button>
                </div>
            </div>
            <div class="input-group">
                <div id="s1-plates-single">
                    æ¿æ•°: <input type="text" id="s1-plates" placeholder="å¦‚:26">
                </div>
                
                <div id="s1-plates-multi" class="multi-stop-box">
                    <label>CMH:<input type="number" id="s1-cmh" value="0"></label>
                    <label>CVG:<input type="number" id="s1-cvg" value="0"></label>
                    <label>SDF:<input type="number" id="s1-sdf" value="0"></label>
                    <label id="lbl-s1-ord" class="hidden">ORD:<input type="number" id="s1-ord" value="0"></label>
                </div>

                æ—¶é—´: <input type="time" id="s1-time">
                UNI: <input type="text" id="s1-uni" placeholder="æ•°å­—å³å¯">
                <button class="btn-add" onclick="addS1()">æ·»åŠ </button>
            </div>
            <div class="queue-list" id="s1-list"></div>
        </div>

        <div class="card s2">
            <h3>ğŸŒŸã€NJ936-80så«æ˜Ÿä»“è½¬è¿ã€‘</h3>
            <div class="input-group">
                <div id="s2-dests">
                    <button class="btn-dest" onclick="setDest('s2','DCA')">DCA</button>
                    <button class="btn-dest" onclick="setDest('s2','PHL')">PHL</button>
                    <button class="btn-dest" onclick="setDest('s2','BOS')">BOS</button>
                    <button class="btn-dest" onclick="setDest('s2','PIT')">PIT</button>
                </div>
                æ¿æ•°: <input type="text" id="s2-plates" placeholder="æ¿æ•°" style="width:60px">
                æ—¶é—´: <input type="time" id="s2-time">
                UNI: <input type="text" id="s2-uni" placeholder="æ•°å­—å³å¯">
                <button class="btn-add" onclick="addS2()">æ·»åŠ </button>
            </div>
            <div class="queue-list" id="s2-list"></div>
        </div>

        <div class="card s3">
            <h3>ğŸŒŸã€NJ936-Han Express JFK+600è½¬è¿ã€‘</h3>
            <div class="input-group">
                <div id="s3-dests">
                    <button class="btn-dest" onclick="setDest('s3','JFK')">JFK</button>
                    <button class="btn-dest" onclick="setDest('s3','600')">600</button>
                </div>
                æ¿æ•°: <input type="text" id="s3-plates" placeholder="æ¿æ•°" style="width:100px" oninput="checkS3Plates()">
                æ—¶é—´: <input type="time" id="s3-time">
            </div>
            <div class="input-group">
                UNI 1: <input type="text" id="s3-uni" placeholder="ä¸»å•å·">
                <span id="s3-uni2-box" class="hidden">
                    UNI 2: <input type="text" id="s3-uni2" placeholder="ç¬¬äºŒå•å·">
                </span>
                <button class="btn-add" onclick="addS3()">æ·»åŠ </button>
            </div>
            <div class="queue-list" id="s3-list"></div>
        </div>

        <div class="card s4">
            <h3>ğŸŒŸã€NJ936 NYQZã€‘</h3>
            <div class="input-group">
                <div id="s4-dests">
                    <button class="btn-dest" onclick="setS4Dest('ATL')">ATL</button>
                    <button class="btn-dest" onclick="setS4Dest('MIA')">MIA</button>
                    <button class="btn-dest" onclick="setS4Dest('CLE-CMH')">CLE-CMH</button>
                    <button class="btn-dest" onclick="setS4Dest('600')">600</button>
                </div>
            </div>
            <div class="input-group">
                <div id="s4-plates-single">
                    æ¿æ•°: <input type="text" id="s4-plates" placeholder="æ¿æ•°" style="width:60px">
                </div>
                
                <div id="s4-plates-multi" class="multi-stop-box">
                    <label>CLE:<input type="number" id="s4-cle" value="0"></label>
                    <label>CMH:<input type="number" id="s4-cmh" value="0"></label>
                </div>

                æ—¥æœŸ: <input type="text" id="s4-date" placeholder="12/17" style="width:70px">
                æ—¶é—´: <input type="time" id="s4-time">
                UNI: <input type="text" id="s4-uni" placeholder="æ•°å­—å³å¯">
                <button class="btn-add" onclick="addS4()">æ·»åŠ </button>
            </div>
            <div class="queue-list" id="s4-list"></div>
        </div>

        <div class="card s5">
            <h3>ğŸŒŸã€NJ936 è¿åŠ›éƒ¨å«è½¦ã€‘</h3>
            <div class="input-group">
                LAX:<input type="number" id="s5-lax" value="0" style="width:45px">
                SEA:<input type="number" id="s5-sea" value="0" style="width:45px">
                SJC:<input type="number" id="s5-sjc" value="0" style="width:45px">
                UNI: <input type="text" id="s5-uni" style="width:80px">
                æ—¶é—´: <input type="time" id="s5-time">
            </div>
            <div class="input-group">
                <div id="s5-carrier">
                    <button class="btn-dest" onclick="setCarrier('Millennium Transport')">Millennium Transport</button>
                    <button class="btn-dest" onclick="setCarrier('Spot Freight')">Spot Freight</button>
                    <button class="btn-dest" onclick="setCarrier('Princeton Logistics')">Princeton Logistics</button>
                    <button class="btn-dest" onclick="setCarrier('ITS Logistics')">ITS Logistics</button>
                </div>
                <button class="btn-add" onclick="addS5()">æ·»åŠ </button>
            </div>
            <div class="queue-list" id="s5-list"></div>
        </div>
    </div>

    <button class="btn-gen" onclick="generate()">ğŸ“ ç”Ÿæˆæœ€ç»ˆæ—¥æŠ¥</button>
    <textarea id="resultArea" readonly></textarea>
    <button class="btn-copy" onclick="copyResult()">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>

    <script>
        // ä¸å†ç»´æŠ¤s2æ•°æ®
        let data = { s1:[], s3:[], s4:[], s5:[] };
        let sel = { s1:'', s3:'', s4:'', carrier:'' };
        
        // ç§»é™¤äº† s2 çš„è¡¨å¤´ï¼Œç”Ÿæˆæœ€ç»ˆå†…å®¹æ—¶å°±ä¸ä¼šå¸¦ä¸Šäº†
        const HEADERS = {
            s1: "ğŸŒŸã€NJ936-80så¤§åŒºè½¬è¿ã€‘",
            s3: "ğŸŒŸã€NJ936-Han Express JFK+600è½¬è¿ã€‘",
            s4: "ğŸŒŸã€NJ936 NYQZã€‘",
            s5: "ğŸŒŸã€NJ936 è¿åŠ›éƒ¨å«è½¦ã€‘"
        };

        window.onload = () => {
            const now = new Date();
            document.getElementById('displayDate').innerText = now.toISOString().split('T')[0];
            const t = getRoundedTime();
            ['s1','s3','s4','s5'].forEach(id => document.getElementById(id+'-time').value = t);
        };

        function getRoundedTime() {
            let n = new Date(), m = n.getMinutes(), h = n.getHours();
            if(m<15) m="00"; else if(m<45) m="30"; else { m="00"; h=(h+1)%24; }
            return String(h).padStart(2,'0')+":"+m;
        }

        function fixUni(val) {
            if(!val) return "";
            val = val.trim();
            return val.toUpperCase().startsWith("UNI") ? val.toUpperCase() : "UNI"+val;
        }

        // --- S1 é€»è¾‘ ---
        function setS1Dest(v) {
            sel.s1 = v;
            document.querySelectorAll(`#s1-dests .btn-dest`).forEach(b => b.classList.toggle('active', b.innerText===v));
            
            const isMulti = (v === 'CMH-CVG-SDF' || v === 'ORD');
            document.getElementById('s1-plates-single').style.display = isMulti ? 'none' : 'block';
            document.getElementById('s1-plates-multi').style.display = isMulti ? 'flex' : 'none';
            
            const ordInput = document.getElementById('lbl-s1-ord');
            if(v === 'ORD') ordInput.classList.remove('hidden');
            else ordInput.classList.add('hidden');
        }

        function addS1() {
            let plateStr = "";
            if(sel.s1 === 'CMH-CVG-SDF' || sel.s1 === 'ORD') {
                const c = parseInt(document.getElementById('s1-cmh').value) || 0;
                const v = parseInt(document.getElementById('s1-cvg').value) || 0;
                const s = parseInt(document.getElementById('s1-sdf').value) || 0;
                const o = parseInt(document.getElementById('s1-ord').value) || 0;

                let parts = [];
                if(c > 0) parts.push(c + "*CMH");
                if(v > 0) parts.push(v + "*CVG");
                if(s > 0) parts.push(s + "*SDF");
                if(sel.s1 === 'ORD' && o > 0) parts.push(o + "*ORD");

                if(parts.length === 0) return alert("è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªç«™ç‚¹çš„æ¿æ•°");
                plateStr = `(${parts.join(', ')})`;
            } else {
                const val = document.getElementById('s1-plates').value;
                if(!val) return alert("è¯·å¡«å†™æ¿æ•°");
                plateStr = `(${val}*${sel.s1})`;
            }

            const u = fixUni(document.getElementById('s1-uni').value);
            if(!sel.s1 || !u) return alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
            
            data.s1.push({ text: `NJ936-${sel.s1} ${plateStr} ${document.getElementById('s1-time').value}å‘ - ${u}`, dbl: false });
            render('s1');
        }

        // --- S4 NYQZ é€»è¾‘ ---
        function setS4Dest(v) {
            sel.s4 = v;
            document.querySelectorAll(`#s4-dests .btn-dest`).forEach(b => b.classList.toggle('active', b.innerText===v));
            
            const isMulti = (v === 'CLE-CMH');
            document.getElementById('s4-plates-single').style.display = isMulti ? 'none' : 'block';
            document.getElementById('s4-plates-multi').style.display = isMulti ? 'flex' : 'none';
        }

        function addS4() {
            let plateStr = "";
            let prefix = "NJ936"; 
            
            if(sel.s4 === 'CLE-CMH') {
                prefix = "EWR936"; 
                const cle = parseInt(document.getElementById('s4-cle').value) || 0;
                const cmh = parseInt(document.getElementById('s4-cmh').value) || 0;
                
                let parts = [];
                if(cle > 0) parts.push(cle + "*CLE");
                if(cmh > 0) parts.push(cmh + "*CMH");
                
                if(parts.length === 0) return alert("è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªç«™ç‚¹çš„æ¿æ•°");
                plateStr = `(${parts.join(', ')})`;
            } else {
                const p = document.getElementById('s4-plates').value;
                if(!p) return alert("è¯·å¡«å†™æ¿æ•°");
                plateStr = `(${p}*${sel.s4})`;
            }

            const d = document.getElementById('s4-date').value;
            const u = fixUni(document.getElementById('s4-uni').value);
            
            if(!sel.s4 || !u) return alert("è¯·å®Œæ•´å¡«å†™");
            
            data.s4.push({ text: `${prefix}-${sel.s4} ${plateStr}${d?' '+d:''} ${document.getElementById('s4-time').value}å‘ - ${u}`, dbl: false });
            render('s4');
        }

        // --- é€šç”¨ & å…¶å®ƒåŸé€»è¾‘ ---
        function setDest(s, v) { sel[s] = v; document.querySelectorAll(`#${s}-dests .btn-dest`).forEach(b => b.classList.toggle('active', b.innerText===v)); }
        function setCarrier(v) { sel.carrier = v; document.querySelectorAll(`#s5-carrier .btn-dest`).forEach(b => b.classList.toggle('active', b.innerText===v)); }

        function checkS3Plates() {
            const p = document.getElementById('s3-plates').value;
            const num = parseInt(p.match(/\d+/)) || 0;
            const u2Box = document.getElementById('s3-uni2-box');
            if(num > 12) u2Box.classList.remove('hidden');
            else u2Box.classList.add('hidden');
        }

        function addS3() {
            const p = document.getElementById('s3-plates').value;
            const u1 = fixUni(document.getElementById('s3-uni').value);
            const u2 = fixUni(document.getElementById('s3-uni2').value);
            if(!sel.s3 || !p || !u1) return alert("è¯·å®Œæ•´å¡«å†™(æ¿æ•°å’ŒUNI1)");
            
            const num = parseInt(p.match(/\d+/)) || 0;
            const isDbl = num > 12;
            if(isDbl && !u2) return alert("å¤§äº12æ¿éœ€è¦å¡«å†™ä¸¤ä¸ªUNIå•å·ï¼");

            let uniDisplay = isDbl ? `(${u1}+${u2})` : u1;
            data.s3.push({ text: `EWR936-${sel.s3} (${p}*${sel.s3}) ${document.getElementById('s3-time').value}å‘ - ${uniDisplay}`, dbl: isDbl });
            render('s3');
            document.getElementById('s3-uni2').value = '';
        }

        // ä»…ä¿ç•™åŸå‡½æ•°å®šä¹‰é˜²æŠ¥é”™ï¼Œä½†ä¸ä¾›ç•Œé¢è°ƒç”¨
        function addS2() {}

        function addS5() {
            const lx=document.getElementById('s5-lax').value, se=document.getElementById('s5-sea').value, sj=document.getElementById('s5-sjc').value, u = fixUni(document.getElementById('s5-uni').value);
            if((lx+se+sj==0) || !u || !sel.carrier) return alert("è¯·å®Œæ•´å¡«å†™");
            let pts = []; if(lx>0) pts.push(lx+'*LAX'); if(se>0) pts.push(se+'*SEA'); if(sj>0) pts.push(sj+'*SJC');
            data.s5.push({ text: `NJ936-LAX (${pts.join(', ')}) ${document.getElementById('s5-time').value}å‘ - ${u}(${sel.carrier})`, dbl: false });
            render('s5');
        }

        function render(s) {
            document.getElementById(s+'-list').innerHTML = data[s].map((item, i) => `<div class="queue-item"><span>${item.text}</span><span class="del-btn" onclick="del('${s}',${i})">âŒ</span></div>`).join('');
        }
        function del(s, i) { data[s].splice(i,1); render(s); }

        function generate() {
            let res = document.getElementById('baseReport').value || `${new Date().toISOString().split('T')[0]}\n\n${Object.values(HEADERS).join('\n\n\n')}`;
            // ç§»é™¤äº† s2
            ['s1','s3','s4','s5'].forEach(k => {
                if(data[k].length === 0) return;
                let h = HEADERS[k], start = res.indexOf(h);
                if(start === -1) return;
                let nextIdx = -1, minDist = Infinity;
                Object.values(HEADERS).forEach(vh => {
                    let idx = res.indexOf(vh, start + 1);
                    if(idx !== -1 && idx < minDist) { minDist = idx; nextIdx = idx; }
                });
                let section = (nextIdx === -1) ? res.substring(start) : res.substring(start, nextIdx);
                let max = 0, reg = /ğŸš—(\d+)(?:\+(\d+))?/g, m;
                while((m = reg.exec(section)) !== null) max = Math.max(max, parseInt(m[1]), m[2]?parseInt(m[2]):0);
                let lines = "", cur = max + 1;
                data[k].forEach(item => {
                    let id = item.dbl ? `${cur}+${cur+1}` : `${cur}`;
                    cur += item.dbl ? 2 : 1;
                    let sep = (k==='s3') ? '. ' : 'ã€';
                    lines += `ğŸš—${id}${sep}${item.text}\n`;
                });
                if(nextIdx !== -1) res = res.substring(0, nextIdx).trimEnd() + "\n" + lines + "\n\n" + res.substring(nextIdx);
                else res = res.trimEnd() + "\n" + lines;
            });
            document.getElementById('resultArea').value = res;
        }

        function copyResult() {
            const a = document.getElementById('resultArea');
            a.select();
            document.execCommand('copy');
            alert("å·²å¤åˆ¶ï¼");
        }
    </script>
</body>
</html>
